<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ruby &middot; Moselog</title>

  <meta name="description" content="Various rants from Mose.">

  <meta name="generator" content="Hugo 0.26-DEV" />
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="mo5e" />
  <meta name="twitter:title" content="Ruby &middot; Moselog">
  <meta name="twitter:description" content="Various rants from Mose.">

  <meta property="og:title" content="Ruby &middot; Moselog">
  <meta property="og:type" content="blog">
  <meta property="og:description" content="Various rants from Mose.">
  
  <meta property="og:image" content="http://res.cloudinary.com/mosepix/image/upload/"/>

  <link rel="shortcut icon" href="http://res.cloudinary.com/mosepix/image/upload/c_scale,w_32/" type="image/jpeg">
  <link rel="apple-touch-icon" sizes="60x60" href="http://res.cloudinary.com/mosepix/image/upload/c_scale,w_60/" type="image/jpeg">
  <link rel="apple-touch-icon" sizes="76x76" href="http://res.cloudinary.com/mosepix/image/upload/c_scale,w_76/" type="image/jpeg">
  <link rel="apple-touch-icon" sizes="120x120" href="http://res.cloudinary.com/mosepix/image/upload/c_scale,w_120/" type="image/jpeg">
  <link rel="apple-touch-icon" sizes="152x152" href="http://res.cloudinary.com/mosepix/image/upload/c_scale,w_152/" type="image/jpeg">
  <link rel="icon" sizes="any" mask="" href="http://res.cloudinary.com/mosepix/image/upload/c_scale,w_60/">
  

  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
  <!--[if lte IE 8]>
      <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
      <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="http://blog.mose.com/css/all.min.css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="alternate" type="application/rss+xml" title="Moselog" href="http://blog.mose.com/index.xml" />
</head>
<body>


<div id="layout" class="pure-g">
  <div class="sidebar pure-u-1 pure-u-md-1-4">
  <div class="header">
    <hgroup>
      <h1 class="brand-title"><a href="http://blog.mose.com">Moselog</a></h1>
      <h2 class="brand-tagline">Various rants from Mose.</h2>
    </hgroup>

    <nav class="nav">
      <ul class="nav-list">
        
        <li class="nav-item">
          <a class="pure-button" href="https://twitter.com/mo5e"><i class="fa fa-twitter"></i> Twitter</a>
        </li>
        
        
        <li class="nav-item">
          <a class="pure-button" href="https://github.com/mose "><i class="fa fa-github-alt"></i> github</a>
        </li>
        
        <li class="nav-item">
          <a class="pure-button" href="http://blog.mose.com/index.xml"><i class="fa fa-rss"></i> rss</a>
        </li>
        <li class="nav-item">
          <a class="pure-button" href="http://mose.com"><i class="fa fa-user-o"></i> about</a>
        </li>
      </ul>
    </nav>
  </div>
  <div class="tags">
  <div>
  
    <a href="http://blog.mose.com/tags/culture" class="tag">culture<span>23</span></a>
  
    <a href="http://blog.mose.com/tags/greenruby" class="tag">greenruby<span>15</span></a>
  
    <a href="http://blog.mose.com/tags/tools" class="tag">tools<span>13</span></a>
  
    <a href="http://blog.mose.com/tags/engineering" class="tag">engineering<span>12</span></a>
  
    <a href="http://blog.mose.com/tags/ruby" class="tag">ruby<span>11</span></a>
  
    <a href="http://blog.mose.com/tags/devops" class="tag">devops<span>7</span></a>
  
    <a href="http://blog.mose.com/tags/collective-intelligence" class="tag">collective-intelligence<span>6</span></a>
  
    <a href="http://blog.mose.com/tags/lifestyle" class="tag">lifestyle<span>6</span></a>
  
    <a href="http://blog.mose.com/tags/webdev" class="tag">webdev<span>6</span></a>
  
    <a href="http://blog.mose.com/tags/rubyconf" class="tag">rubyconf<span>5</span></a>
  
    <a href="http://blog.mose.com/tags/chatbot" class="tag">chatbot<span>4</span></a>
  
    <a href="http://blog.mose.com/tags/javascript" class="tag">javascript<span>4</span></a>
  
    <a href="http://blog.mose.com/tags/debian" class="tag">debian<span>3</span></a>
  
    <a href="http://blog.mose.com/tags/rubygems" class="tag">rubygems<span>3</span></a>
  
    <a href="http://blog.mose.com/tags/blogging" class="tag">blogging<span>2</span></a>
  
    <a href="http://blog.mose.com/tags/freebsd" class="tag">freebsd<span>2</span></a>
  
    <a href="http://blog.mose.com/tags/hackathon" class="tag">hackathon<span>2</span></a>
  
    <a href="http://blog.mose.com/tags/mail" class="tag">mail<span>2</span></a>
  
    <a href="http://blog.mose.com/tags/meetups" class="tag">meetups<span>2</span></a>
  
    <a href="http://blog.mose.com/tags/security" class="tag">security<span>2</span></a>
  
    <a href="http://blog.mose.com/tags/slack" class="tag">slack<span>2</span></a>
  
    <a href="http://blog.mose.com/tags/taipei" class="tag">taipei<span>2</span></a>
  
    <a href="http://blog.mose.com/tags/timezones" class="tag">timezones<span>2</span></a>
  
    <a href="http://blog.mose.com/tags/chef" class="tag">chef<span>1</span></a>
  
    <a href="http://blog.mose.com/tags/mailchimp" class="tag">mailchimp<span>1</span></a>
  
    <a href="http://blog.mose.com/tags/perl" class="tag">perl<span>1</span></a>
  
    <a href="http://blog.mose.com/tags/python" class="tag">python<span>1</span></a>
  
    <a href="http://blog.mose.com/tags/sublimetext" class="tag">sublimetext<span>1</span></a>
  
    <a href="http://blog.mose.com/tags/vim" class="tag">vim<span>1</span></a>
  
  </div>
</div>

  

<div class="pagination">
  <nav role="pagination" class="post-list-pagination">
    
    <span class="button-small pure-button pure-button-disabled">
      <i class="fa fa-hand-o-left"></i>&nbsp;Newer
    </span>
    
    <span class="post-list-pagination-item post-list-pagination-item-current button-small pure-button">Page 1 of 2</span>
    
    <a href="http://blog.mose.com/tags/ruby/page/2/" class="post-list-pagination-item button-small pure-button post-list-pagination-item-next">
      Older&nbsp;<i class="fa fa-hand-o-right"></i>
    </a>
    
  </nav>
</div>



</div>


  <div class="content pure-u-1 pure-u-md-3-4">
    <div>
      
      <div class="posts">
        
          <h1 class="content-subhead">
  2016-02-28
  <p class="post-meta">
    
    
      originally posted on 
      
        <a class="post-origin" href="http://greenruby.org/grn-160.html" target="_new">GreenRuby</a>
      
    
    
      <a class="post-tags post-tags-ruby" href="http://blog.mose.com/tags/ruby">ruby</a><a class="post-tags post-tags-engineering" href="http://blog.mose.com/tags/engineering">engineering</a>
    
    
  </p>
</h1>

          <section class="post">
            <header class="post-header">

              <a href="http://blog.mose.com/2016/02/28/about-tests-and-documentation/" class="post-title">About tests and documentation</a>
            </header>

            <div class="post-description">
              <p>This aspect of development, called Documentation, is the source of various
frustrations. It&rsquo;s hard to get do it, but why? My feeling is that it&rsquo;s like
testing. When you begin your craft as a coder, all what matters is the code.
It&rsquo;s only after some iterations that some non-code aspects come back bite you
in the neck. Like, huho, now that I need to refactor, I really should use
something that tells me if all still works. Tests become an early necessity to
anyone who knows that kind of truth. If you wait until the end of a coding
cycle to write those, the task is huge and it cuts you from your productivity
cycle. Write them early, along the flow, is way easier.</p>

<p>So I think documentation follows the same pattern. So many software projects
are badly documented because this aspect is postponed until it&rsquo;s needed. Means
at release stage. In early stages, you work on a prototype and you don&rsquo;t need
to explain how things work or are supposed to work. And when it&rsquo;s released,
there is usually some other task waiting and it&rsquo;s hard to stop everything to
get back and document things properly. It may be a flaw in the agile process,
but it may also be a feature: if you don&rsquo;t document along the way, you won&rsquo;t
document much.</p>

<p>Personally I try to consider the documentation of any of the source code I
write as one of the first tasks. There are various tricks that can help in
that perspective, like <a href="http://tom.preston-werner.com/2010/08/23/readme-driven-development.html">readme-driven development</a>, or including the doc
inside the code with <a href="http://yardoc.org/">yarddoc</a> or <a href="http://ilyabylich.svbtle.com/apipie-amazing-tool-for-documenting-your-rails-api">apipie</a>, or coupling
documentation with tests with <a href="https://www.relishapp.com/zipmark/rspec-api-documentation/docs/generate-html-documentation-from-test-examples">rspec</a> or <a href="https://github.com/zipmark/rspec_api_documentation">RSpec API Doc
Generator</a>. But honestly I prefer edited documentation that can follow
a structure that is thought as documentation rather than merely an automated
output of some code.</p>

<p>There are various tools to organize edited documentation, like
<a href="https://readthedocs.org/">ReadTheDoc</a> which is in python. Another project appeared last week from
the guys at Pluralsight named <a href="http://tutorials.pluralsight.com/faq/">hack.guide()</a>. That&rsquo;s a community project
but actually being totally open sourced, I was thinking the <a href="https://github.com/pluralsight/guides-cms">documentation
building CMS</a> they made could pretty much fill the gap of a
light-weight RTD, with the benefits of having a UI for editors. Too bad we
don&rsquo;t have anything like this in ruby (or do we?).</p>

            </div>
          </section>
        
          <h1 class="content-subhead">
  2015-11-08
  <p class="post-meta">
    
    
      originally posted on 
      
        <a class="post-origin" href="http://greenruby.org/grn-144.html" target="_new">GreenRuby</a>
      
    
    
      <a class="post-tags post-tags-debian" href="http://blog.mose.com/tags/debian">debian</a><a class="post-tags post-tags-ruby" href="http://blog.mose.com/tags/ruby">ruby</a>
    
    
  </p>
</h1>

          <section class="post">
            <header class="post-header">

              <a href="http://blog.mose.com/2015/11/08/packaging-a-gem-for-debian/" class="post-title">Packaging a gem for Debian</a>
            </header>

            <div class="post-description">
              <p>Recently I had to package a gem for debian as a .deb. As a matter of fact,
there is a lot of companies that are not in the ruby ecosystem and they rely
on things they trust rather than rubygems. For a while debian was way behind
on the inclusion of ruby and versions were outdated there. So a parallel
distribution ecosystem had to be created. Now we have rvm, rbenv, or chruby
for ruby and bundler and rubygems for the packages. But where I work, they
package everything as debian packages. So I had to adapt.</p>

<p>So I went have a look at <a href="https://wiki.debian.org/Teams/Ruby">the debian ruby team</a> and checked out
the tools. That gem2deb tool is pretty convenient. I am using debian for a
while but never really had to package anything. The debian community process
is a bit complicated and they are not very inclusive. Compared to the ease of
uploading any gem to rubygems, it&rsquo;s quite a fortress, and people in the
process are not very welcoming.</p>

<p>Maybe it&rsquo;s generational. Debian started before sourceforge existed, they are
rooted in a community tradition that are very exclusive and a bit elitist. But
technology changes faster than people, obviously. Younger communities
bootstrap in a more fluid environment.</p>

<p>I&rsquo;m not sure it is related but maybe it is, there was another epic [Linus
Hit][liushit] recently. Well, all those things put in perspective the niceness
of the ruby community. Really, cherish it and enjoy it, it&rsquo;s precious.</p>

            </div>
          </section>
        
          <h1 class="content-subhead">
  2015-11-01
  <p class="post-meta">
    
    
      originally posted on 
      
        <a class="post-origin" href="http://greenruby.org/grn-143.html" target="_new">GreenRuby</a>
      
    
    
      <a class="post-tags post-tags-ruby" href="http://blog.mose.com/tags/ruby">ruby</a>
    
    
  </p>
</h1>

          <section class="post">
            <header class="post-header">

              <a href="http://blog.mose.com/2015/11/01/the-power-of-dsl/" class="post-title">The power of DSL</a>
            </header>

            <div class="post-description">
              <p>While I was playing with <a href="https://github.com/zetachang/react.rb">react.rb</a> and exploring <a href="http://opalrb.org/">opal</a>, I
felt in a totally different world. The power of the DSL already prove its
shine on various occasions. I got to experience it in activeadmin, rspec, and
puppet (but I kind of dislike the one in puppet).</p>

<p>As I&rsquo;m also writing some python, I can see a real difference in expressibility
that can be found in ruby. Really, ruby is a maker tool. Like a toolbox for
making new programming languages, using meta-programming, lambda and other
goodies. This is what, in my opinion, makes ruby unique. Beyond the elegance
of its syntax, it empowers developers with the ability to write dedicated
programming language for any specific use. And this, I didn&rsquo;t find in python.</p>

            </div>
          </section>
        
          <h1 class="content-subhead">
  2015-04-05
  <p class="post-meta">
    
    
      originally posted on 
      
        <a class="post-origin" href="http://greenruby.org/grn-113.html" target="_new">GreenRuby</a>
      
    
    
      <a class="post-tags post-tags-lifestyle" href="http://blog.mose.com/tags/lifestyle">lifestyle</a><a class="post-tags post-tags-ruby" href="http://blog.mose.com/tags/ruby">ruby</a>
    
    
  </p>
</h1>

          <section class="post">
            <header class="post-header">

              <a href="http://blog.mose.com/2015/04/05/multiple-inheritance-simulation/" class="post-title">Multiple inheritance simulation</a>
            </header>

            <div class="post-description">
              

<p>This is a bit twisted. In ruby, as you know, you cannot use multiple
inheritance. But the flexibility of the language, especially the
metaprogramming aspect, opens the door for some cheating. Check out
<a href="https://gist.github.com/capitalist/473543b7ea24d461d030">this code</a>, it tricks it by declaring the first class as the super
class and the remaining classes as modules included in that super class.
Pretty acrobatic and elegant, imho.</p>

<h2 id="about-vaping">About vaping</h2>

<p>Well this has been my burden for 30 years, and I&rsquo;m not proud of it. But last
week it finally ended. I quit smoking. But this was kindof a trick, as it was
made possible by switching to <a href="http://gizmodo.com/5-facts-that-everyone-gets-wrong-about-vaping-1659938937">vaping</a>. It certainly doesn&rsquo;t solve the
nicotine addiction issue, but I&rsquo;m very happy with this move and hopeful for a
gradual freedom.</p>

<p>I also found out that this vaping practice is very geeky. The hardware part is
quite elaborate, vaping devices are really neat piece of work, there are a
bunch of vendors. The liquidware is also quite a subject of hacking.
Technically it&rsquo;s not that hard to do it yourself. Not surprising that I
discovered this vaping practice in geeks circles.</p>

            </div>
          </section>
        
          <h1 class="content-subhead">
  2015-03-08
  <p class="post-meta">
    
    
      originally posted on 
      
        <a class="post-origin" href="http://greenruby.org/grn-109.html" target="_new">GreenRuby</a>
      
    
    
      <a class="post-tags post-tags-ruby" href="http://blog.mose.com/tags/ruby">ruby</a><a class="post-tags post-tags-freebsd" href="http://blog.mose.com/tags/freebsd">freebsd</a><a class="post-tags post-tags-blogging" href="http://blog.mose.com/tags/blogging">blogging</a>
    
    
  </p>
</h1>

          <section class="post">
            <header class="post-header">

              <a href="http://blog.mose.com/2015/03/08/about-blogging/" class="post-title">About blogging</a>
            </header>

            <div class="post-description">
              

<p>Well, since that whole blogging thing began, I never have been very active on
it. Well, I have a <a href="http://blog.mose.com">blog</a> on Tumblr because I wanted to know how they
are doing it, I published various posts in the <a href="http://devtips.faria.co/authors.html#mose-ref">faria devtips</a>, and
after all, this rant could also count as a publication. So I think I will
gather them all under one unique site. A Jekyll github-pages kind, easy and
cheap.</p>

<p>After all, I&rsquo;m not sure the devtips website will stay up any longer. There
have been no post since the day I left. Too bad. It&rsquo;s a demonstration that
some collective actions can sometimes rely only on the energy of one person.</p>

<p>So, I made a <a href="http://mose.github.io/blog">new repo</a> on github for it, and I will gather whatever
stuff I can find that I wrote in there.</p>

<h2 id="lovely-freebsd">Lovely FreeBSD</h2>

<p>At our Gandi office in Taipei I had to install a <a href="https://www.pfsense.org/">pfsense</a> server,
which is based on <a href="https://www.freebsd.org/">FreeBSD</a>. It was quite a pleasant experience,
actually. Last time I played a bit with BSD that was 12 years ago, and that
was not very smooth. I&rsquo;m happy to be given that occasion to see how it goes
now.</p>

<p>For now I&rsquo;m going to use it like if it was an <a href="https://openwrt.org/">OpenWRT</a> with some
extra <a href="https://openvpn.net/index.php/open-source.html">OpenVPN</a> abilities. And it will also be a file server for the
LAN. Not sure yet how I will handle that.</p>

<h2 id="ruby-package-management">Ruby package management</h2>

<p>When I got in my new job, I discovered a new way to manage server management.
They didn&rsquo;t want to use <a href="http://rvm.io/">rvm</a>, or even <a href="https://rubygems.org/">ruby gems</a>, or
<a href="https://pip.pypa.io/en/latest/">pip</a> or anything that is not debian packages. It may sound quite harsh.
Since I came in ruby in 2010, rvm has been my best friend, bundle the second
one. But this approach is very developer-based. When you maintain large and
stable systems, it&rsquo;s more likely that you will not trust the bleeding edge
stuff and prefer confirmed publication of packages before using them. This is
an interesting slap on my face.</p>

<p>Of course there are the <a href="https://www.brightbox.com/docs/ruby/ubuntu/">brightbox</a> packages for Ubuntu, but that&rsquo;s
missing the point. A release has to be out for a certain time so it can be
strengthened by security reviews and proper production usage. There is a part
of the population for each language that is considering the instability of
current releases a normal trade-off. but there is a huge lot of other
companies that will wait patiently that things get stable enough for their
taste.</p>

            </div>
          </section>
        
          <h1 class="content-subhead">
  2015-03-01
  <p class="post-meta">
    
    
      originally posted on 
      
        <a class="post-origin" href="http://greenruby.org/grn-108.html" target="_new">GreenRuby</a>
      
    
    
      <a class="post-tags post-tags-lifestyle" href="http://blog.mose.com/tags/lifestyle">lifestyle</a><a class="post-tags post-tags-ruby" href="http://blog.mose.com/tags/ruby">ruby</a>
    
    
  </p>
</h1>

          <section class="post">
            <header class="post-header">

              <a href="http://blog.mose.com/2015/03/01/working-abroad/" class="post-title">Working abroad</a>
            </header>

            <div class="post-description">
              

<p>Our craft as webdev is clearly in huge demand. This provides an opportunity
for us to travel abroad, discover new cultures, widen our horizon. When I went
to live in Taiwan, I was not worried about finding a job. But when hunting for
a job abroad it can be tricky to find companies that will sponsor a visa, a
work permit, or whatever legal requirement is involved in each countries.</p>

<p>That&rsquo;s what the new initiative called <a href="http://techmeabroad.com">TechMeAbroad</a> aims to fix, by
listing only job opportunities for which a work permit is sponsored. As
<a href="http://jbarbier42.tumblr.com/post/112155851079/introducing-techmeabroad">Julien Barbier explains</a>, it will launch in march, and if you know of any
job offers that includes a visa or such thing, please let him know (or send it
to me I will pass it along), so we can feed that platform with some real data
quickly.</p>

<h2 id="so-long-ruby-1-9">So long ruby 1.9</h2>

<p>As planned, it&rsquo;s now time to say <a href="https://www.ruby-lang.org/en/news/2015/02/23/support-for-ruby-1-9-3-has-ended/">byebye to ruby 1.9.3</a>. But there is still
so many old version of ruby in the wild. In debian squeeze, you gotta use 1.8.
In wheezy, you have 1.9. And there are still many servers that will refuse to
upgrade.</p>

<h2 id="pick-your-hero">Pick your hero</h2>

<p>The registration for <a href="http://rubyheroes.com/">Ruby Heroes 2015</a> is now open. Go vote for your
favorite ruby influential dev. You have until <a href="http://railsconf.com/">railsconf</a> that will happen
in april, in Atlanta this year.</p>

            </div>
          </section>
        
          <h1 class="content-subhead">
  2015-01-18
  <p class="post-meta">
    
    
      originally posted on 
      
        <a class="post-origin" href="http://greenruby.org/grn-102.html" target="_new">GreenRuby</a>
      
    
    
      <a class="post-tags post-tags-ruby" href="http://blog.mose.com/tags/ruby">ruby</a><a class="post-tags post-tags-meetups" href="http://blog.mose.com/tags/meetups">meetups</a><a class="post-tags post-tags-tools" href="http://blog.mose.com/tags/tools">tools</a>
    
    
  </p>
</h1>

          <section class="post">
            <header class="post-header">

              <a href="http://blog.mose.com/2015/01/18/greenruby-102/" class="post-title">Greenruby 102</a>
            </header>

            <div class="post-description">
              

<h2 id="while42">While42</h2>

<p>This week I got in contact with Sylvain from <a href="http://while42.org">while42</a>. It&rsquo;s a social
network for french tech engineers, but with a special touch on it. There is no
facebook page or google group. They intentionally decided to be irl-first. For
people that are most likely to be online all the time, this sounds so
therapeutic! So, I decided, with Thomas from Gandi, to setup a Taiwan chapter.
If you want to know more (and are french, engineer, and living in Taipei) just
drop me a mail.</p>

<h2 id="traveling-ruby">Traveling ruby</h2>

<p>This is a project from the <a href="http://www.phusion.nl/">Phusion</a> people, called <a href="https://github.com/phusion/traveling-ruby">Traveling ruby</a>.
Its purpose is to make it easy to build auto-sustaining tarballs for ruby
programms, including ruby binary and all gems in it. That way you can publish
a tarball and your customer/user will just launch whatever you put in it. No
need to install ruby or any gems.</p>

<p>I gave it a try yesterday on my <a href="https://github.com/eduvo/zabbix-ruby-client">zabbix-ruby-client</a> gem, and after a few
tweaks (mostly because I wanted to use an unpublished version of my gem), it
all worked pretty fine. Result is a tarball of 8M. Uploaded to the server (an
old squeeze), it just ran the self-contained ruby 2.1.5 with no hassle. It
reminded me a bit of the feeling when you upload a go executable on the
server. Really neat.</p>

<h2 id="palm-control">Palm control</h2>

<p>There are tiny things that can change a lot. My recent tiny thing is the palm
control technique. Every sunday when I prepare Green Ruby I do a huge amount
of copy pasting all over the place. Recently I found on a post about keyboard
someone talking about the palm control technique for avoiding the copypaste
fatigue.</p>

<p>Well, you need to have a keyboard that makes it possible. Mine is a <a href="http://support.logitech.com/en_us/product/10104">Logitech washable k310</a>.
I already liked its look, and even better, it&rsquo;s perfect for
this palm thing because keys are prominent. Use the palm to push control and
then it&rsquo;s only a matter of hitting c or v with the index. Honestly, it changed
my life!</p>

            </div>
          </section>
        
          <h1 class="content-subhead">
  2014-06-12
  <p class="post-meta">
    
    
      originally posted on 
      
        <span class="post-origin">faria devtips</span>
      
    
    
      <a class="post-tags post-tags-ruby" href="http://blog.mose.com/tags/ruby">ruby</a><a class="post-tags post-tags-devops" href="http://blog.mose.com/tags/devops">devops</a>
    
    
  </p>
</h1>

          <section class="post">
            <header class="post-header">

              <a href="http://blog.mose.com/2014/06/12/s3-backups/" class="post-title">S3 backups</a>
            </header>

            <div class="post-description">
              <p>We use S3 to backup various kind of files on MB. We use the very convenient backup gem for that (we still use 3.9.0).</p>

<ul>
<li><a href="http://meskyanichi.github.io/backup/v4/">http://meskyanichi.github.io/backup/v4/</a></li>
</ul>

<p>But at some point it appeared that backing up our audio recording was hammering disk IO on our server, because the syncer is calculating md5 footprint for each file each time a backup happens. When you get thousands of big files that is pretty expensive process (in our case 20k files and 50G total).</p>

<p>So I added a small trick there:</p>

<p>in <code>Backup/models/backup_audio.rb</code></p>

<pre><code class="language-ruby">module Backup::Syncer::Cloud
  class Base &lt; Syncer::Base
    def process_orphans
      if @orphans.is_a?(Queue)
        @orphans = @orphans.size.times.map { @orphans.shift }
      end
      &quot;Older Files: #{ @orphans.count }&quot;
    end
  end
end

Backup::Model.new(:backup_audio, 'Audio files Backup to S3') do

  before do
    system(&quot;/Backup/latest_audio.sh&quot;)
  end

  after do
    FileUtils.rm_rf(&quot;/tmp/streams&quot;)
  end

  ##
  # Amazon Simple Storage Service [Syncer]
  #
  sync_with Cloud::S3 do |s3|
    s3.access_key_id     = &quot;xxx&quot;
    s3.secret_access_key = &quot;xxx&quot;
    s3.bucket            = &quot;bucket_backup&quot;
    s3.region            = &quot;us-east-1&quot;
    s3.path              = &quot;/mb_audio_backup&quot;
    s3.mirror            = false
    s3.thread_count      = 50

    s3.directories do |directory|
      directory.add &quot;/tmp/streams&quot;
    end
  end
end
</code></pre>

<p>and in <code>Backup/latest_audio.sh</code></p>

<pre><code class="language-bash">#!/bin/sh
# isolate files changed in the last 3 days

TMPDIR=/tmp/streams

mkdir $TMPDIR
for i in `find /storage/audio/ -type f -cmin -4320`; do
  ln -s $i $TMPDIR
done
</code></pre>

<p>It creates a fake backup dir with links to the files that actually changed in the last 3 days and patches the syncer to avoid flooding the logs with orphan files. When sometimes S3 upload fails on one file (and it happens from time to time for &lsquo;amazonian&rsquo; reason) it will be caught on the next daily backup.</p>

<p>The result was pretty obvious on our disk usage with our daily backups:</p>

<img src="http://res.cloudinary.com/mosepix/image/upload/devtips/2014-06-12-s3backup.png" alt="graph" class="pure-img" />



<p>in the logs:</p>

<pre><code>[2014/06/10 07:00:25][info] Summary:
[2014/06/10 07:00:25][info]   Transferred Files: 5
[2014/06/10 07:00:25][info]   Older Files: 22371
[2014/06/10 07:00:25][info]   Unchanged Files: 16
[2014/06/10 07:00:25][info] Syncer::Cloud::S3 Finished!
[2014/06/10 07:00:25][info] Backup for 'Audio files Backup to S3 (backup_audio)' Completed Successfully in 00:00:22
[2014/06/10 07:00:25][info] After Hook Starting...
[2014/06/10 07:00:25][info] After Hook Finished.
</code></pre>

            </div>
          </section>
        
          <h1 class="content-subhead">
  2014-05-27
  <p class="post-meta">
    
    
      originally posted on 
      
        <span class="post-origin">faria devtips</span>
      
    
    
      <a class="post-tags post-tags-ruby" href="http://blog.mose.com/tags/ruby">ruby</a><a class="post-tags post-tags-rubygems" href="http://blog.mose.com/tags/rubygems">rubygems</a>
    
    
  </p>
</h1>

          <section class="post">
            <header class="post-header">

              <a href="http://blog.mose.com/2014/05/27/gem-reverse-dependencies/" class="post-title">Gem reverse dependencies</a>
            </header>

            <div class="post-description">
              <p>I have been looking for a way to see what gem uses a gem, so I can see examples of integration in other projects. The rubygems API guide don&rsquo;t tell anything about such reverse dependency query. But it is actually there, it got merged some time ago, and optimized, but it is not documented yet (it runs really fast, kudos Rubygems guys).</p>

<pre><code class="language-ruby">ruby -ropen-uri -rpp -ryaml \
     -e 'pp YAML.load(open(&quot;https://rubygems.org/api/v1/gems/rails_best_practices/reverse_dependencies.yaml&quot;))'

[&quot;metric_fu&quot;,
 &quot;flyerhzm-metric_fu&quot;,
 &quot;edouard-metric_fu&quot;,
 &quot;devver-metric_fu&quot;,
 &quot;goldstar-metric_fu&quot;,
 &quot;socializer&quot;,
 &quot;trollface&quot;,
 &quot;guard-rails_best_practices&quot;,
 &quot;rferraz-metric_fu&quot;,
 &quot;git-hooks-helper&quot;,
 &quot;odor&quot;,
 &quot;rake_check&quot;,
 &quot;koality&quot;,
 &quot;danmayer-metric_fu&quot;,
 &quot;bf4-metric_fu&quot;,
 &quot;metrics_satellite&quot;,
 &quot;code_hunter&quot;,
 &quot;kinit&quot;,
 &quot;rails-audit&quot;,
 &quot;pronto-rails_best_practices&quot;,
 &quot;free_disk_space&quot;,
 &quot;warder&quot;,
 &quot;ruby_osx_app&quot;,
 &quot;sanelint&quot;]
</code></pre>

<p>Out of curiosity I counted some wellknown gems usages by adding a <code>.count</code> at the end:</p>

<pre><code>rake:    23766
rails:   6283
thor:    2786
pry:     2870
sinatra: 1964
devise:  422 
</code></pre>

            </div>
          </section>
        
          <h1 class="content-subhead">
  2014-05-22
  <p class="post-meta">
    
    
      originally posted on 
      
        <span class="post-origin">faria devtips</span>
      
    
    
      <a class="post-tags post-tags-ruby" href="http://blog.mose.com/tags/ruby">ruby</a><a class="post-tags post-tags-tools" href="http://blog.mose.com/tags/tools">tools</a>
    
    
  </p>
</h1>

          <section class="post">
            <header class="post-header">

              <a href="http://blog.mose.com/2014/05/22/hackpad-cli/" class="post-title">Hackpad cli</a>
            </header>

            <div class="post-description">
              <p>In Faria we use hackpad a lot, it&rsquo;s pretty useful. Mose made a command line interface so he can download all the pads locally and grep them all in one go. It also transforms the markdown much better than the original hackpad markdown export, which totally sucks (as for now). So pads can be recycled easily in github wiki pages.</p>

<ul>
<li><a href="https://github.com/mose/hackpad-cli">https://github.com/mose/hackpad-cli</a></li>
</ul>

            </div>
          </section>
        
      </div>
      

<div class="pagination">
  <nav role="pagination" class="post-list-pagination">
    
    <span class="button-small pure-button pure-button-disabled">
      <i class="fa fa-hand-o-left"></i>&nbsp;Newer
    </span>
    
    <span class="post-list-pagination-item post-list-pagination-item-current button-small pure-button">Page 1 of 2</span>
    
    <a href="http://blog.mose.com/tags/ruby/page/2/" class="post-list-pagination-item button-small pure-button post-list-pagination-item-next">
      Older&nbsp;<i class="fa fa-hand-o-right"></i>
    </a>
    
  </nav>
</div>



      <div class="footer">
  <div class="pure-menu pure-menu-horizontal pure-menu-open">
    <ul>
      <li>Generated with <a class="hugo" href="http://gohugo.io/" target="_blank">hugo</a></li>
    </ul>
  </div>
</div>
<script src="http://blog.mose.com/js/all.min.js"></script>

    </div>
  </div>
</div>


</body>
</html>
